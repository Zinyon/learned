# 프로세스와 스레드

> 프로세스와 스레드의 차이
>
> 멀티 프로세스와 멀티 스레드의 장단점



## 프로세스와 스레드의 차이

프로세스란, 

* 운영체제로부터 자원을 할당받는 작업의 단위이며, 
* 메모리에 올라와 실행되고 있는 프로그램의 인스턴스(독립적인 개체)를 의미한다.

스레드란,

* 프로세스 내에서 실행되는 흐름의 단위

* 프로세스의 특정한 수행 경로를 의미한다.

  

#### 프로그램과 프로세스

하드디스크 등의 보조기억장치에 저장된 실행 코드. 프로세스는 프로그램을 구동하여 메모리 상에서 실행되고 있는 작업 단위이다. 



### 프로세스의 구조

![image](https://user-images.githubusercontent.com/49153756/95016525-769c2780-068e-11eb-9c04-22da6a232278.png)

code -> stack으로 갈수록 높은 주소(high address)값을 할당받는다.



#### stack 영역

프로그램이 자동으로 사용하는 메모리 영역

* 함수호출과 관계되는 지역변수와 매개변수가 저장된다.

* 스레드는 stack 영역만 할당받고 나머지 영역은 프로세스 내에서 공유한다.

#### Heap 영역

메모리를 동적으로 할당할 때 사용하는 영역. 

* head과 stack은 같은 공간을 공유한다. heap이 낮은 주소부터 할당되면, stack은 높은 주소부터 할당된다.

#### Data 영역

전역변수, 정적변수, 배열, 구조체 등이 저장되는 영역.

Data는 초기화여부에 따라 BSS와 GVAR로 나뉘어진다.

* BSS : 초기화되지 않은 데이터
* GVAR : 초기화된 데이터

#### Code(Text) 영역

코드들이 들어가는 영역.

컴파일한 프로그램이 저장되어 있고, 읽기 전용 영역.



### 특징

* 기본적으로 프로세스당 하나 이상의 스레드를 할당받는다.

* 프로세스는 각각 별도의 주소공간에서 실행되며, 독립된 메모리 영역을 할당받는다.

  => 따라서 다른 프로세스에 접근하려면 프로세스간 통신(IPC)을 사용해야 한다.

  ex) 파이프, 파일, 소켓

* 스레드는 프로세스 내에서 Stack만 따로 할당받고, 나머지 Code, Data, Heap 영역은 공유한다.

* 한 스레드가 프로세스 자원을 변경하면 다른 스레드도 그 변경 결과를 즉시 볼 수 있다.



### PCB(프로세스 제어 블록)

특정 프로세스에 대한 중요한 정보를 저장하고 있는 운영체제의 자료구조. 프로세스 전환이 발생하면 작업의 진행상황을 PCB에 저장하고 CPU를 반환한다. 다시 CPU를 할당받게 되면 PCB에 저장되어 있는 내용을 불러와 이전 시점부터 다시 작업을 수행한다.

PCB에 저장되는 정보는 다음과 같다.

* 프로세스 식별자(PID)
* 프로세스 상태 : new, ready, running, waiting, terminated
* 프로그램 카운터 : 프로그램이 실행할 다음 명령어의 주소
* CPU 레지스터
* CPU 스케줄링 정보 : 프로세스의 우선순위
* 메모리 관리 정보 : 페이지 테이블 또는 세그먼트 테이블
* 입출력 상태 정보 : 입출력 장치들과 열린 파일 목록
* 어카운팅 정보 : 사용된 CPU 시간, 시간제한, 계정번호 등



## 멀티 프로세스와 멀티 스레드

### 멀티 프로세스

멀티 프로세스란,

* 하나의 응용프로그램을 여러 개의 프로세스로 구성하여 각 프로세스가 하나의 작업을 처리하도록 하는 것

**장점**

* 여러개의 프로세스 중 하나에 문제가 발생하면 해당 프로세스만 영향을 받고 다른 프로세스에 영향을 주지 않는다.

**단점**

* Context Switching 과정에서 오버헤드가 발생한다.
  * 프로세스는 독립된 메모리 영역을 할당받았기 때문에 Context Switching이 발생하면 모든 데이터를 리셋하고 다시 캐시 정보를 불러와야 한다. 
* 프로세스들 사이의 변수를 공유할 수 없다.

**Context Switching**

* CPU에서 여러 프로세스에 대한 작업을 처리하는 과정
* 동작 중인 프로세스가 상태(Context)를 보관하고, 다음 순서의 프로세스가 동작하면서 상태를 복구하는 작업



### 멀티 스레드

멀티 스레딩이란,

* 하나의 응용프로그램을 여러 개의 스레드로 구성하여 각 스레드가 하나의 작업을 처리하도록 하는 것

**장점**

* 자원의 효율적인 관리
  * 프로세스를 생성하여 자원을 할당하는 시스템 콜이 줄어든다.
  * 빠른 Context Switching이 일어난다. (작은 작업단위, 공유 데이터)

* 통신 시간 단축

**단점**

* 자원 공유의 문제로 충돌이 발생할 수 있다.
* 하나의 스레드에 문제가 발생하면 스레드가 속한 전체 프로세스가 영향을 받는다.



### Reference

https://gmlwjd9405.github.io/2018/09/14/process-vs-thread.html

[https://github.com/gyoogle/tech-interview-for-developer/blob/master/Computer%20Science/Operating%20System/Process%20vs%20Thread.md](https://github.com/gyoogle/tech-interview-for-developer/blob/master/Computer Science/Operating System/Process vs Thread.md)

[https://kyu9341.github.io/%EC%9A%B4%EC%98%81%EC%B2%B4%EC%A0%9C/2020/10/04/OS_Process_Structure/](https://kyu9341.github.io/운영체제/2020/10/04/OS_Process_Structure/)